import streamlit as st
import streamlit_sortables as sortables

st.set_page_config(page_title="Q-Method 버블 정렬", layout="wide")
st.title("Q-Method 진술문 정렬 (버블 드래그 방식)")

with st.expander("📘 조사 개요", expanded=True):
    st.markdown("""
        본 조사는 데이터센터의 기술·입지·사람·거버넌스에 대한 사회적 수용성과 관련된 다양한 진술문에 대해, 귀하의 인식을 파악하고자 합니다. 
        한국공학대학교 주관 학술 연구 목적으로 수행되는 본 조사는 조사지 자체의 익명성이 유지되며 응답자 고유성을 확인하기 위해 이메일을 수집 후 파기합니다. 
        모든 섹션에 참여하시는 데 10분 이내로 소요되며, 참여해주신 분께는 약소하오나 소중한 시간을 내어주신 데 대한 감사의 의미로 자문 수당(10만원, 세전)을 별도로 송금해 드립니다.
        데이터센터는 인공지능, 클라우드, 디지털 산업 발전을 가능하게 하는 핵심 기반 시설입니다. 하지만 그와 동시에 막대한 전력을 소비하고, 물을 많이 사용하며, 입지 선정 과정에서 시민들과 갈등을 빚기도 합니다.
        동 연구에서는
        - 시민들은 데이터센터에 대해 어떤 생각을 가지고 있을까? 
        - 그 판단은 어떤 가치나 우선순위에 따라 달라질까? 
        를 알아보기 위한 목적을 가지고 설문조사를 시행하고 있습니다.
        설문은 총 24개의 문장을 제시하며, 이 문장들은 사람들이 데이터센터에 대해 흔히 하는 주장이나 의견을 정리한 것입니다.
        """)
with st.expander("🧩 Q-Sort 방식 안내 및 각 섹션 설명", expanded=True):
    st.markdown("""
    설문은 Q-sort 방식으로 진행되며, 제시된 24개 문장을 “나는 이 생각에 얼마나 동의하는가?”의 기준으로 순서대로 정렬해 주세요.
    문장들은 다음 네 개의 관점으로 구성되어 있습니다:
      1) 기술(Technology), 이 영역은 데이터센터가 어떤 기술을 사용하는지를 시민들이 어떻게 바라보는지를 다룹니다. 예를 들어 재생에너지 사용 여부, 친환경 냉각 기술, 백업 전력 방식, 기술의 안전성과 거리감 등이 여기에 포함됩니다. 당신은 기술의 종류나 방식이 시민의 신뢰나 수용성에 어떤 영향을 줄 수 있다고 생각하십니까?
      2) 사람 (People), 이 영역은 데이터센터를 둘러싼 사람들 간의 관계와 신뢰, 참여의 방식에 관한 시민들의 인식을 다룹니다. 예를 들어 시민 의견이 반영되었는지, 설명회가 형식적이지 않았는지, 정부와 기업 중 누가 더 신뢰받는지 등이 포함됩니다. 데이터센터와 관련된 다양한 이해관계자들 사이의 신뢰와 관계가, 시민들의 수용성 판단에 어떤 영향을 준다고 생각하십니까?
      3) 장소 (Place), 이 영역은 데이터센터가 어디에 들어서느냐에 따라 시민들이 어떻게 반응하는지를 다룹니다. 기존 산업 부지의 활용, 지역 정체성과의 조화, 자연환경 훼손, 수도권/지방 차이, 외부 자본 주도의 불신 가능성 등이 포함됩니다. 당신은 입지의 특성과 맥락이 시민 수용성에 어떤 영향을 줄 수 있다고 생각하십니까?
      4) 과정 (Process), 이 영역은 데이터센터가 어떤 절차와 방식으로 결정·운영되었는지를 시민들이 어떻게 평가하는지를 다룹니다. 예를 들어 정보 공개 시점, 환경영향평가의 신뢰도, 기업–지자체 협력 여부, 사후 모니터링의 유무 등이 포함됩니다. 당신은 결정 과정의 투명성과 참여 방식이 시민의 신뢰와 수용에 어떤 영향을 줄 수 있다고 생각하십니까?
    """)
    
# 초기 그룹화된 버블
group_labels = ["기술(Technology)", "사람(People)", "장소(Place)", "과정(Process)"]
group_items = [
            ["(기술)시민들은 데이터센터가 재생에너지를 쓰면 환경에 책임 있다고 느낄 수 있다.",
                "(기술)시민들은 데이터센터가 디젤이나 가스 발전기를 백업 전력으로 쓰면 환경에 해롭다고 생각할 수 있다.",
                "(기술)시민들은 데이터센터가 물 절약이나 친환경 냉각 기술을 쓰면 더 신뢰할 수 있다고 느낄 수 있다.",
                "(기술)시민들은 데이터센터가 최신 기술을 쓰더라도 안전하지 않으면 불안해할 수 있다.",
                "(기술)시민들은 데이터센터 기술이 비용보다 사회적 책임을 우선해야 한다고 생각할 수 있다.",
                "(기술)시민들은 데이터센터 기술이 너무 낯설거나 복잡하면 거리감을 느낄 수 있다."],
            ["(사람)시민들은 데이터센터 건설에 자신의 의견이 반영되지 않으면 반발할 수 있다.",
                "(사람)시민들은 지역과 오랫동안 관계를 맺은 기업의 데이터센터를 더 신뢰할 수 있다.",
                "(사람)시민들은 데이터센터 설명회가 형식적으로 보이면 불신을 가질 수 있다.",
                "(사람)시민들은 정보에 접근하기 어려우면 데이터센터에 불안감을 가질 수 있다.",
                "(사람)시민들은 중립적인 제3자가 갈등을 조정하면 도움이 된다고 느낄 수 있다.",
                "(사람)시민들은 동일한 내용이라도 데이터센터 기업보다는 정부의 설명을 더 신뢰한다."],
            ["(장소)시민들은 공장이나 발전소 부지를 재활용한 데이터센터에 더 호감을 가질 수 있다.",
                "(장소)시민들은 데이터센터가 지역 정체성과 어울리지 않으면 거부감을 느낄 수 있다.",
                "(장소)시민들은 자연경관을 훼손하는 데이터센터는 기술이 좋아도 받아들이기 어렵다고 느낄 수 있다.",
                "(장소)시민들은 수도권과 지방이 데이터센터를 받아들이는 기준이 다르다고 느낄 수 있다.",
                "(장소)시민들은 지역과 무관한 외부투자자나 글로벌 기업이 일방적으로 입지를 정할 경우 지역사회를 고려하지 않은 이익 중심 판단이라고 느껴 신뢰하지 않을 수 있다.",
                "(장소)시민들은 데이터센터가 지역에 실질적 혜택을 줄 경우 더 수용할 수 있다."],
            ["(과정)시민들은 데이터센터 정보가 초기에 투명하게 공개되면 신뢰할 수 있다고 느낄 수 있다.",
                "(과정)시민들은 환경영향평가 결과가 수용 여부 판단에 중요하다고 생각할 수 있다.", 
                "(과정)시민들은 기업과 지자체가 함께 결정한 데이터센터를 더 신뢰할 수 있다.",
                "(과정)시민들은 데이터센터 사업이 법적 요건을 충족했다고 해서 신뢰까지 얻기는 어렵다고 느낄 수 있다.",
                "(과정)시민들은 지역 언론이 데이터센터 관련 보도를 신속하고 정확하게 전달할 때 더 신뢰성이 높다고 느낀다.",
                "(과정)시민들은 데이터센터가 완공된 이후에도 모니터링과 피드백이 있어야 신뢰를 유지할 수 있다고 생각할 수 있다."]
]

col1, col2 = st.columns([1, 2])

with col1:
    st.subheader("🧱 그룹별 정렬")
    bubble_lists = sortables.sort_items(
        [{"label": label, "items": items} for label, items in zip(group_labels, group_items)],
        "horizontal",
        True,
        key="sort1"
    )

with col2:
    st.subheader("🗂️ 최종 순위 정렬 (1~24위)")
    flat = [item for group in bubble_lists for item in group]
    final = sortables.sort_items(
        flat,
        "vertical",
        False,
        key="sort2"
    )

    if st.button("✅ 제출"):
        st.success("정렬 완료! 아래에 순위를 다시 보여드립니다.")
        st.markdown("---")
        for idx, item in enumerate(final, 1):
            st.markdown(f"**{idx}위**: {item}")
